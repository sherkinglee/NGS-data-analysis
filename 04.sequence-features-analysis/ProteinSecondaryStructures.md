## **Protein secondary structures**

这里主要是针对氨基酸序列进行二级结构的预测。蛋白质的二级结构包括三种常见形态，α-螺旋，β-折叠，无规则卷曲等等。这里采用的工具是[PSIPRED](http://bioinf.cs.ucl.ac.uk/index.php?id=779).

+ [PSIPRED](http://bioinfadmin.cs.ucl.ac.uk/downloads/psipred/)下载和安装
+ fasta序列的分割

```
## 将AA.fa序列分割成单个蛋白质的序列，然后进行二级结构的预测
#!/usr/bin/python
# -*- coding: UTF-8 -*-

import numpy as np
import sys
import os
from itertools import groupby
from optparse import OptionParser

def creat_parse():
    usage='''Try to split a fasta file with multiple sequences into a single fasta file with a single sequence. with:\n\tpython %prog [opt
ions]'''
    parser=OptionParser(usage=usage)
    parser.add_option('-i','--input',action='store',type='string',dest='fastaFile',help='Input file, fasta format')
    parser.add_option('-o','--output',action='store',type='string',dest='outputDir',help='Output directory')

    return parser

def splitFastaFile(input_file,outputDir):
    if not os.path.exists(outputDir):
        os.makedirs(outputDir)
    with open(input_file,'r') as f:
        files=f.readlines()
        for i in np.arange(len(files)):
            if ">" in files[i].strip():
                targetName=files[i].strip().strip(">").split(' ')[0]
                # os.mkdir(outputDir.strip().rstrip('/')+"/"+targetName)
                # with open(outputDir.strip().rstrip('/')+"/"+targetName+"/"+targetName+".fasta","w") as fount:
                with open(outputDir.strip().strip('/')+"/"+targetName+".fasta","w") as fount:
                    fount.write("%s\n" %(files[i].strip()))
                    fount.write("%s" %(files[i+1]))

def main():
    parser=creat_parse()
    (options,args)=parser.parse_args()
    (input_file,output_dir)=(options.fastaFile,options.outputDir)
    print("Start split the fasta files...",file=sys.stderr)
    splitFastaFile(input_file,output_dir)
    print("Finish the step of split the fasta file~",file=sys.stderr)


if __name__=="__main__":
    main()

## 脚本使用
python fastaFileSplit.py -i test.fa -o test_dir

## 其中test.fa包括每条氨基酸序列，test_dir包括每条氨基酸序列的fasta文件
```

+ 运行psipred软件预测蛋白质的二级结构

```
workdir=/workdata/LabMember2/lifj/lifj/Project/05.Ribo_seq_human/GSE70211/25.AAStructure/374_up
fastaFile=/workdata/LabMember2/lifj/lifj/Project/05.Ribo_seq_human/GSE70211/25.AAStructure/374_up/fastaFiles
outputDir=$workdir/ssFile

mkdir -p $outputDir


for i in `ls $fastaFile`;do
    cd $outputDir
    bsub -e job_err -o job_out "runpsipredplus $fastaFile/$i"
    #if [ "$?" != "0" ];then
        #cat ${i%.*} >> $workdir/non_hit.txt
    #fi
    #cd $workdir
done

```


+ 将ss2文件转化成为fasta文件

```
#!/usr/bin/python
# -*- coding: UTF-8 -*-

import pandas as pd
import numpy as np
import os
import sys
from optparse import OptionParser

def creat_parse():
    usage='''python %prog [options]'''
    parser=OptionParser(usage=usage)
    parser.add_option('-i','--inputDir',action='store',type='string',dest='inDir',help='Input dir where contains all the .ss2 files')
    parser.add_option('-o','--outputDir',action='store',type='string',dest='outDir',help='Output directory')
    return parser

def Second2Fasta(input_dir,output_dir):
    #if os.path.exists(output_dir):
     #   os.makedirs(output_dir)
    files=[file for file in os.listdir(input_dir) if file.endswith('ss2')]
    for file in files:
        data=pd.read_table(input_dir.strip().strip('/')+'/'+file,sep="\s+",skiprows=[0,1],header=None)
        secondStr=data.iloc[:,2].values
        secondStr=''.join(secondStr)
        with open(output_dir.strip().strip('/')+'/'+file.strip().split('.')[0]+'.fasta',"w") as f:
            f.write("%s%s\n" %(">",file.strip().split('.')[0]))
            f.write("%s\n" %(secondStr))

def main():
    parser=creat_parse()
    (options,args)=parser.parse_args()
    (input_dir,output_dir)=(options.inDir,options.outDir)
    print("Start fasta file transformation...",file=sys.stderr)
    Second2Fasta(input_dir,output_dir)
    print("Finishing the tasks",file=sys.stderr)


if __name__=="__main__":
    main()
    
## 脚本使用
python Second2Fasta.py -i $workdir/ssFile -o $workdir/SecStru

```

+ 将所有的二级结构文件merge起来

```
cat $workdir/SecStru/*.fasta >> secondaryStructure.fa
```

+ 对位置信息进行选择，比如想看前50aa的二级结构形式

```
#!/usr/bin/python
# -*- coding:utf-8 -*-

import pandas as pd
import numpy as np
# import os
import sys
import re
from optparse import OptionParser

__version__="1.0.0"

def creat_parser():
    '''argument parser.'''
    usage="usage: %prog [options]" + "\n"
    parser=OptionParser(usage=usage,version="%prog" + __version__)
    parser.add_option("-i","--input", action="store",type="string",dest="fastaFile",
            help="Input file(s) in fasta format. Generated by merging the files from Second2Fasta.py")
    parser.add_option("-l","--left_coor",action="store",type="int",dest="left_position",
            help="The left position of the sequence you  wanna to extract.[required]")
    parser.add_option("-r","--right_coor",action="store",type="int",dest="right_position",
            help=" The right position of the sequence you  wanna to extract[required]")
    parser.add_option("-o","--otput_prefix",action="store",type="string",dest="output_prefix",
            help="Prefix of output files.[required]")
    return parser

def local_sequence(fastaFile,leftCoor,rightCoor,outputFile):
    '''select the local sequence from the leftCoor to rightCoor'''
    with open(outputFile+"_local_sequence.fa",'w') as f:
        with open(fastaFile,'r') as fount:
            files=fount.readlines()
            for i in np.arange(len(files)):
                if ">" in files[i].strip():
                    header=files[i]
                    seq=files[i+1]
                    local_seq=seq[leftCoor-1:rightCoor]
                    f.write("%s%s\n" %(header,local_seq))

def main():
    parser=creat_parser()
    (options,args)=parser.parse_args()
    (fastaFile,left_coor,right_coor,output_prefix)=(options.fastaFile,options.left_position,
        options.right_position,options.output_prefix)
    print("Your input fasta file is : " + str(fastaFile),file=sys.stderr)
    local_sequence(fastaFile,left_coor,right_coor,output_prefix)
    print("Finish the step of extract local sequence!")


if __name__ == "__main__":
    main()
(END)

## 脚本使用
python extractSequence.py -i secondaryStructure.fa -l 1 -r 50 -o first50AA
```

+ 长度过滤，考虑到很多氨基酸序列并不会有50长度，把不满足50aa的氨基酸序列去掉

```
#!/usr/bin/env python
# -*- coding:UTF-8 -*-
'''
@Author: Li Fajin
'''

import numpy as np
import sys
import os
from itertools import groupby
from optparse import OptionParser

def creat_parse():
    usage='''Try to split a fasta file with multiple sequences into a single fasta file with a single sequence. with:\n\tpython %prog [options]'''
    parser=OptionParser(usage=usage)
    parser.add_option('-i','--input',action='store',type='string',dest='fastaFile',help='Input file, fasta format')
    parser.add_option('-l','--length',action='store',type='int',default=1,dest='length',help='minimun length of sequences in fasta file.')
    parser.add_option('-o','--output',action='store',type='string',dest='outprefix',help='Prefix of output file.')

    return parser
def Make_seq_dict(transcriptFasta):
        transcript_sequence={}
        with open(transcriptFasta,"r") as f:
                fastaFile=f.readlines()
                for i in np.arange(len(fastaFile)-1):
                        if fastaFile[i].strip()=='':
                            continue
                        if fastaFile[i].strip()[0]!=">":
                            continue
                        transcript_sequence[fastaFile[i].strip().strip(">").split(" ")[0]]=fastaFile[i+1].strip()
        return transcript_sequence

def filterSequences(fastaFile,length,outprefix):
    fastaDict=Make_seq_dict(fastaFile)
    i=0
    with open(outprefix+"_filtered.fa",'w') as f:
        for trans,seq in fastaDict.items():
            if len(seq) < length:
                i+=1
                continue
            f.write("%s%s\n" % (">",trans))
            f.write("%s\n" %(seq))
    print("There are " + str(i)+" sequences less than "+ str(length)+" nt!")


def main():
    parser=creat_parse()
    (options,args)=parser.parse_args()
    print("Start filtering...",file=sys.stderr)
    filterSequences(options.fastaFile,options.length,options.outprefix)
    print("Finish filtering!",file=sys.stderr)

if __name__=="__main__":
    main()

## 脚本使用
python filterFastaFile.py -i input.fa -o outprefix -l 50

```

+ 将最后得到的fasta序列用weblogo3生成logo，看看有没有可能存在二级结构的保守性。